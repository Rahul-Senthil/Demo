{"ast":null,"code":"import _asyncToGenerator from\"D:/React Projects/rental-app/rental/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/React Projects/rental-app/rental/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"D:\\\\React Projects\\\\rental-app\\\\rental\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import axios from'axios';import jwtDecode from'jwt-decode';import React,{useEffect,useState}from'react';import{useParams}from'react-router-dom';import{FaFileUpload}from'react-icons/fa';import'../css/EditPost.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EditPost=function EditPost(){var _useParams=useParams(),id=_useParams.id;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),post=_useState2[0],setPost=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),files=_useState6[0],setFiles=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),img=_useState8[0],setImg=_useState8[1];var updatedImg=useState([]);var doDeleteImg=useState([]);var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),customError=_useState10[0],setCustomError=_useState10[1];var address=/*#__PURE__*/React.createRef();var mobile=/*#__PURE__*/React.createRef();var rent=/*#__PURE__*/React.createRef();var description=/*#__PURE__*/React.createRef();useEffect(function(){var fetchPost=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var token,_user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"Post id: \",id);token=sessionStorage.getItem(\"secretToken\");console.log(token);if(token){_user=jwtDecode(token);console.log(\"user id: \",_user.currentUser);setUser(_user.currentUser);}else{window.location.href='/home';}_context.next=6;return axios.get(\"http://localhost:8000/specific-post/\".concat(id)).then(function(res){setPost(res.data);setImg(res.data.imgUrl);}).catch(function(err){return console.log(err);});case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetchPost(){return _ref.apply(this,arguments);};}();fetchPost();},[]);var onFileUpload=function onFileUpload(e){setFiles(e.target.files);if(e.target.files.length>1){document.getElementById(\"filename\").innerHTML=e.target.files.length+\" files selected\";}else{document.getElementById(\"filename\").innerHTML=e.target.files.length+\" file selected\";}};var validation=function validation(addressValue,mobileValue,rentValue,descriptionValue,updatedImgLength){var mobilePattern='[6789][0-9]{9}';var rentPattern='^[1-9]+[0-9]*$';console.log(files.length+updatedImgLength);var c=0;if(files.length>0){for(var i=0;i<files.length;i++){if(files[i].type.split(\"/\")[1]!=='jpeg'&&files[i].type.split(\"/\")[1]!=='jpg'&&files[i].type.split(\"/\")[1]!=='png'){setCustomError(\"*Only Image can be uploaded\");console.log(files[i].type.split(\"/\")[1]);c++;return false;}}}if(c==0){if(files.length+updatedImg==0){setCustomError(\"*Atleat 1 image is required\");return false;}if(files.length+updatedImgLength>4){setCustomError(\"*Only 4 Images can be uploaded\");return false;}if(!addressValue){setCustomError(\"*Address is required\");return false;}else if(addressValue.length<10){setCustomError(\"*Address should be more than 10 characters\");return false;}else if(!mobileValue){setCustomError(\"*Mobile Number is required\");return false;}else if(!mobileValue.match(mobilePattern)||mobile.current.value.length!=10){setCustomError(\"*Mobile Number should be 10 digits\");return false;}else if(!rentValue){setCustomError(\"*Rent is required\");return false;}else if(!rentValue.match(rentPattern)){setCustomError(\"*Rent should not be negative\");return false;}else if(!descriptionValue){setCustomError(\"*Description is Required\");return false;}else{setCustomError(\" \");return true;}}};var editPost=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var addressValue,mobileValue,rentValue,descriptionValue,imgs,i,isValidated,formData,_i,config,newPost;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();addressValue=address.current.value;mobileValue=mobile.current.value;rentValue=rent.current.value;descriptionValue=description.current.value;console.log(\"Clicked\");updatedImg.length=0;doDeleteImg.length=0;imgs=document.getElementsByName(\"deleteImg\");for(i=0;i<img.length;i++){console.log(imgs[i].checked);if(imgs[i].checked!==true){console.log(img[i]);updatedImg.push(img[i]);}else{doDeleteImg.push(img[i]);}}console.log(doDeleteImg);console.log(updatedImg);isValidated=validation(addressValue,mobileValue,rentValue,descriptionValue,updatedImg.length);if(!isValidated){_context2.next=24;break;}document.getElementById(\"btn\").value=\"Saving...\";if(!(files.length>0)){_context2.next=21;break;}formData=new FormData();for(_i=0;_i<files.length;_i++){formData.append(\"image\",files[_i]);}config={headers:{'content-type':'multipart/form-data'}};_context2.next=21;return axios.post(\"http://localhost:8000/generate-url\",formData,config).then(function(res){console.log(res.data);for(var _i2=0;_i2<res.data.length;_i2++){updatedImg.push({filename:res.data[_i2].filename,url:res.data[_i2].path});}}).catch(function(err){return console.log(err);});case 21:newPost={author_id:user,address:addressValue,mobile:mobileValue,rent:rentValue,description:descriptionValue,imgUrl:updatedImg,date:new Date()};console.log(newPost);if(doDeleteImg.length>0){// FIXME: delete from cloudinary\n// axios.post('http://localhost:8000/delete-img-cloudinary', doDeleteImg)\n// .then(res => {\n// console.log(res);\naxios.post(\"http://localhost:8000/edit-post/\".concat(id),newPost).then(function(res){console.log(res.data);window.location.href=\"/account/\".concat(user);}).catch(function(err){return console.log(err);});}else{axios.post(\"http://localhost:8000/edit-post/\".concat(id),newPost).then(function(res){if(typeof res.data=='object'){console.log(res.data);setCustomError(res.data.error);}else{window.location.href=\"/account/\".concat(user);}}).catch(function(err){return console.log(err);});}case 24:case\"end\":return _context2.stop();}}},_callee2);}));return function editPost(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"edit-form-page\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Edit \",/*#__PURE__*/_jsx(\"span\",{style:{color:\"black\"},children:\"Post\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"edit-form-container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"edit-post-form\",children:/*#__PURE__*/_jsxs(\"form\",{action:\"\",onSubmit:editPost,children:[/*#__PURE__*/_jsxs(\"label\",{for:\"uploadfile\",className:\"upload-label\",children:[\"Select Image from device \",/*#__PURE__*/_jsx(FaFileUpload,{}),\"   \",/*#__PURE__*/_jsx(\"span\",{style:{color:\"red\"},id:\"filename\",children:\"0 file selected\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"image\",accept:\"image/*\",id:\"uploadfile\",onChange:onFileUpload,multiple:true}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Address\",defaultValue:post.address,ref:address}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Mobile Number\",defaultValue:post.mobile,ref:mobile}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Rent\",defaultValue:post.rent,ref:rent}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"select\",{name:\"\",id:\"\",ref:description,children:[/*#__PURE__*/_jsx(\"option\",{defaultValue:post.description,children:post.description}),/*#__PURE__*/_jsx(\"option\",{value:\"1 Bedroom\",children:\"1 Bed Room\"}),/*#__PURE__*/_jsx(\"option\",{value:\"2 Bedroom\",children:\"2 Bed Room\"}),/*#__PURE__*/_jsx(\"option\",{value:\"3 Bedroom\",children:\"3 Bed Room\"}),/*#__PURE__*/_jsx(\"option\",{value:\"4 Bedroom\",children:\"4 Bed Room\"})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),img.map(function(i){return/*#__PURE__*/_jsx(\"div\",{className:\"del-img\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"img\",{src:i.url,alt:\"\",width:300}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",name:\"deleteImg\",id:\"\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Click the checkbox to delete the image\"})]})});}),customError?/*#__PURE__*/_jsx(\"p\",{style:{color:'red'},children:customError}):'',/*#__PURE__*/_jsx(\"input\",{type:\"submit\",value:\"Edit Post\",id:\"btn\",style:{backgroundColor:\"rgb(236, 89, 138)\",border:\"none\"}})]})})})]});};export default EditPost;","map":{"version":3,"sources":["D:/React Projects/rental-app/rental/src/components/EditPost.jsx"],"names":["axios","jwtDecode","React","useEffect","useState","useParams","FaFileUpload","EditPost","id","post","setPost","user","setUser","files","setFiles","img","setImg","updatedImg","doDeleteImg","customError","setCustomError","address","createRef","mobile","rent","description","fetchPost","console","log","token","sessionStorage","getItem","currentUser","window","location","href","get","then","res","data","imgUrl","catch","err","onFileUpload","e","target","length","document","getElementById","innerHTML","validation","addressValue","mobileValue","rentValue","descriptionValue","updatedImgLength","mobilePattern","rentPattern","c","i","type","split","match","current","value","editPost","preventDefault","imgs","getElementsByName","checked","push","isValidated","formData","FormData","append","config","headers","filename","url","path","newPost","author_id","date","Date","error","color","map","backgroundColor","border"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport jwtDecode from 'jwt-decode';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { FaFileUpload } from 'react-icons/fa';\r\nimport '../css/EditPost.css';\r\n\r\nconst EditPost = () => {\r\n\r\n    const {id} = useParams();\r\n    const [post, setPost] = useState([]);\r\n    const [user, setUser] = useState();\r\n    const [files, setFiles] = useState([]);\r\n    const [img, setImg] = useState([]);\r\n    const updatedImg = useState([]);\r\n    const doDeleteImg = useState([]);\r\n    const [customError, setCustomError] = useState();\r\n\r\n    const address = React.createRef();\r\n    const mobile = React.createRef();\r\n    const rent = React.createRef();\r\n    const description = React.createRef();\r\n\r\n    useEffect(() => {\r\n        const fetchPost= async() => {\r\n            console.log(\"Post id: \", id);\r\n            const token = sessionStorage.getItem(\"secretToken\");\r\n            console.log(token);\r\n            if(token)\r\n            {\r\n                const user = jwtDecode(token);\r\n                console.log(\"user id: \", user.currentUser);\r\n                setUser(user.currentUser);\r\n            }\r\n            else{\r\n                window.location.href = '/home';\r\n            }\r\n            await axios.get(`http://localhost:8000/specific-post/${id}`)\r\n            .then(res => {\r\n                setPost(res.data);\r\n                setImg(res.data.imgUrl);\r\n            })\r\n            .catch(err => console.log(err));\r\n        }\r\n        fetchPost()\r\n    },[])\r\n\r\n    const onFileUpload = (e) => {\r\n        setFiles(e.target.files);\r\n        if(e.target.files.length>1)\r\n        {\r\n            document.getElementById(\"filename\").innerHTML = e.target.files.length + \" files selected\";\r\n        }\r\n        else{\r\n            document.getElementById(\"filename\").innerHTML = e.target.files.length + \" file selected\";\r\n        }\r\n    }\r\n\r\n    const validation = (addressValue, mobileValue, rentValue, descriptionValue, updatedImgLength) => {\r\n        const mobilePattern = '[6789][0-9]{9}';\r\n        const rentPattern = '^[1-9]+[0-9]*$';\r\n        console.log(files.length+updatedImgLength);\r\n        let c=0;\r\n        if(files.length>0){\r\n        for(let i=0;i<files.length;i++)\r\n        {\r\n            if(files[i].type.split(\"/\")[1] !== 'jpeg' && files[i].type.split(\"/\")[1] !== 'jpg' && files[i].type.split(\"/\")[1] !== 'png')\r\n            {\r\n                setCustomError(\"*Only Image can be uploaded\");\r\n                console.log(files[i].type.split(\"/\")[1]);\r\n                c++;\r\n                return false;\r\n            }\r\n        }\r\n        }\r\n        if(c==0){\r\n        if(files.length+updatedImg == 0)\r\n        {\r\n            setCustomError(\"*Atleat 1 image is required\");\r\n            return false;\r\n        }\r\n        if(files.length+updatedImgLength>4)\r\n        {\r\n            setCustomError(\"*Only 4 Images can be uploaded\");\r\n            return false;\r\n        }\r\n        if(!addressValue)\r\n        {\r\n            setCustomError(\"*Address is required\");\r\n            return false;\r\n        }\r\n        else if(addressValue.length<10)\r\n        {\r\n            setCustomError(\"*Address should be more than 10 characters\");\r\n            return false;\r\n        }\r\n        else if(!mobileValue)\r\n        {\r\n            setCustomError(\"*Mobile Number is required\");\r\n            return false;\r\n        }\r\n        else if(!mobileValue.match(mobilePattern) || mobile.current.value.length != 10)\r\n        {\r\n            setCustomError(\"*Mobile Number should be 10 digits\");\r\n            return false;\r\n        }\r\n        else if(!rentValue)\r\n        {\r\n            setCustomError(\"*Rent is required\");\r\n            return false;\r\n        }\r\n        else if(!rentValue.match(rentPattern))\r\n        {\r\n            setCustomError(\"*Rent should not be negative\");\r\n            return false;\r\n        }\r\n        else if(!descriptionValue)\r\n        {\r\n            setCustomError(\"*Description is Required\");\r\n            return false;\r\n        }\r\n        else{\r\n            setCustomError(\" \")\r\n            return true;\r\n        }\r\n    }\r\n    }\r\n    const editPost = async(e) => {\r\n        e.preventDefault();\r\n        const addressValue = address.current.value;\r\n        const mobileValue = mobile.current.value;\r\n        const rentValue = rent.current.value;\r\n        const descriptionValue = description.current.value;\r\n        console.log(\"Clicked\");\r\n        updatedImg.length = 0;\r\n        doDeleteImg.length = 0;\r\n        const imgs = document.getElementsByName(\"deleteImg\");\r\n        for(let i=0;i<img.length;i++)\r\n        {\r\n            console.log(imgs[i].checked);\r\n            if(imgs[i].checked !== true)\r\n            {\r\n                console.log(img[i]);\r\n                updatedImg.push(img[i]);\r\n            }\r\n            else\r\n            {\r\n                doDeleteImg.push(img[i]);\r\n            }\r\n        }\r\n        console.log(doDeleteImg);\r\n        console.log(updatedImg);\r\n        let isValidated = validation(addressValue, mobileValue, rentValue, descriptionValue, updatedImg.length);\r\n        if(isValidated)\r\n        {\r\n            document.getElementById(\"btn\").value = \"Saving...\";\r\n            if(files.length>0)\r\n            {\r\n                const formData = new FormData();\r\n                for(let i=0;i<files.length;i++)\r\n                {\r\n                    formData.append(\"image\", files[i]);\r\n                }\r\n                const config = {\r\n                    headers: {\r\n                        'content-type' : 'multipart/form-data'\r\n                    }\r\n                }\r\n                await axios.post(\"http://localhost:8000/generate-url\", formData, config)\r\n                .then(res => {\r\n                    console.log(res.data);\r\n                    for(let i=0;i<res.data.length;i++)\r\n                    {\r\n                        updatedImg.push({\r\n                            filename: res.data[i].filename,\r\n                            url: res.data[i].path\r\n                        });\r\n                    }\r\n                })\r\n                .catch(err => console.log(err));\r\n            }\r\n            const newPost = {\r\n                author_id: user,\r\n                address: addressValue,\r\n                mobile: mobileValue,\r\n                rent: rentValue,\r\n                description: descriptionValue,\r\n                imgUrl: updatedImg,\r\n                date: new Date()\r\n            }\r\n            console.log(newPost);\r\n\r\n            if(doDeleteImg.length>0)\r\n            {\r\n                // FIXME: delete from cloudinary\r\n                // axios.post('http://localhost:8000/delete-img-cloudinary', doDeleteImg)\r\n                // .then(res => {\r\n                    // console.log(res);\r\n                    axios.post(`http://localhost:8000/edit-post/${id}`, newPost)\r\n                    .then(res => {\r\n                        console.log(res.data);\r\n                        window.location.href = `/account/${user}`;\r\n                    })\r\n                    .catch(err => console.log(err));\r\n            }\r\n            else\r\n            {\r\n                axios.post(`http://localhost:8000/edit-post/${id}`, newPost)\r\n                .then(res => {\r\n                    if(typeof(res.data) == 'object')\r\n                    {\r\n                        console.log(res.data);\r\n                        setCustomError(res.data.error);\r\n                    }\r\n                    else\r\n                    {\r\n                        window.location.href = `/account/${user}`;\r\n                    }\r\n                })\r\n                .catch(err => console.log(err));\r\n            }\r\n        }\r\n    }\r\n\r\n  return (\r\n    <div className='edit-form-page'>\r\n      <h1>Edit <span style={{color: \"black\"}}>Post</span></h1>\r\n      <div className=\"edit-form-container\">\r\n      <div className='edit-post-form'>\r\n        <form action=\"\" onSubmit={editPost}>\r\n        <label for=\"uploadfile\" className='upload-label'>Select Image from device <FaFileUpload/>   <span style={{color: \"red\"}} id=\"filename\">0 file selected</span></label>\r\n        <input type=\"file\" name=\"image\" accept='image/*' id=\"uploadfile\" onChange={onFileUpload} multiple/><br /><br />\r\n        <input type=\"text\" placeholder='Address' defaultValue={post.address} ref={address}/><br /><br />\r\n        <input type=\"text\" placeholder='Mobile Number' defaultValue={post.mobile} ref={mobile}/><br /><br />\r\n        <input type=\"text\" placeholder='Rent' defaultValue={post.rent} ref={rent}/><br /><br />\r\n        <select name=\"\" id=\"\" ref={description}>\r\n            <option defaultValue={post.description}>{post.description}</option>\r\n            <option value=\"1 Bedroom\">1 Bed Room</option>\r\n            <option value=\"2 Bedroom\">2 Bed Room</option>\r\n            <option value=\"3 Bedroom\">3 Bed Room</option>\r\n            <option value=\"4 Bedroom\">4 Bed Room</option>\r\n        </select><br /><br />\r\n        {img.map((i) => (\r\n            <div className='del-img'>\r\n                <div>\r\n                <img src={i.url} alt=\"\" width={300}/><br/>\r\n                <input type=\"checkbox\" name=\"deleteImg\" id=\"\"/>\r\n                <p>Click the checkbox to delete the image</p>\r\n                </div>\r\n            </div>\r\n        ))}\r\n        {customError? <p style={{color: 'red'}}>{customError}</p>: ''}\r\n        <input type=\"submit\" value=\"Edit Post\" id='btn' style={{backgroundColor: \"rgb(236, 89, 138)\", border: \"none\"}}/>\r\n      </form>\r\n      </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default EditPost\r\n"]},"metadata":{},"sourceType":"module"}