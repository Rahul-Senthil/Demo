{"ast":null,"code":"import _asyncToGenerator from\"D:/React Projects/rental-app/rental/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/React Projects/rental-app/rental/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"D:\\\\React Projects\\\\rental-app\\\\rental\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useEffect}from'react';import axios from'axios';import{useState}from'react';import jwtDecode from'jwt-decode';import'../css/NewPost.css';import{FaFileUpload}from'react-icons/fa';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var NewPost=function NewPost(){var address=/*#__PURE__*/React.createRef();var mobile=/*#__PURE__*/React.createRef();var rent=/*#__PURE__*/React.createRef();var description=/*#__PURE__*/React.createRef();var _useState=useState(),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),files=_useState4[0],setFiles=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),imageLink=_useState6[0],setImageLink=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),customError=_useState8[0],setCustomError=_useState8[1];useEffect(function(){var fetchToken=function fetchToken(){var token=sessionStorage.getItem(\"secretToken\");console.log(token);if(token){var _user=jwtDecode(token);console.log(_user.currentUser);setUser(_user.currentUser);}else{window.location.href='/home';}};fetchToken();},[]);var onFileUpload=function onFileUpload(e){setFiles(e.target.files);if(e.target.files.length>1){document.getElementById(\"filename\").innerHTML=e.target.files.length+\" files selected\";}else{document.getElementById(\"filename\").innerHTML=e.target.files.length+\" file selected\";}};var validation=function validation(addressValue,mobileValue,rentValue,descriptionValue){var mobilePattern='[6789][0-9]{9}';var rentPattern='^[1-9]+[0-9]*$';var c=0;for(var i=0;i<files.length;i++){if(files[i].type.split(\"/\")[1]!=='jpeg'&&files[i].type.split(\"/\")[1]!=='jpg'&&files[i].type.split(\"/\")[1]!=='png'){setCustomError(\"*Only Image can be uploaded\");console.log(files[i].type.split(\"/\")[1]);c++;return false;}}if(c==0){if(!files.length){setCustomError(\"*Image is required\");return false;}else if(files.length>4){setCustomError(\"*Only 4 Images can be uploaded\");return false;}else if(!addressValue){setCustomError(\"*Address is required\");return false;}else if(addressValue.length<10){setCustomError(\"*Address should be more than 10 characters\");return false;}else if(!mobileValue){setCustomError(\"*Mobile Number is required\");return false;}else if(!mobileValue.match(mobilePattern)||mobile.current.value.length!=10){setCustomError(\"*Enter a valid Mobile Number\");return false;}else if(!rentValue){setCustomError(\"*Rent is required\");return false;}else if(!rentValue.match(rentPattern)){setCustomError(\"*Rent should not be negative\");return false;}else if(!descriptionValue){setCustomError(\"*Description is Required\");return false;}else{setCustomError(\" \");return true;}}};var addPost=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var addressValue,mobileValue,rentValue,descriptionValue,isValidated,formData,i,config;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();addressValue=address.current.value;mobileValue=mobile.current.value;rentValue=rent.current.value;descriptionValue=description.current.value;console.log(\"Clicked\");isValidated=validation(addressValue,mobileValue,rentValue,descriptionValue);console.log(isValidated);if(!isValidated){_context.next=15;break;}document.getElementById(\"btn\").value=\"Saving...\";formData=new FormData();for(i=0;i<files.length;i++){formData.append(\"image\",files[i]);}config={headers:{'content-type':'multipart/form-data'}};_context.next=15;return axios.post(\"http://localhost:8000/generate-url\",formData,config).then(function(res){console.log(res.data);imageLink.length=0;for(var _i=0;_i<res.data.length;_i++){imageLink.push({filename:res.data[_i].filename,url:res.data[_i].path});}console.log(addressValue);var newPost={author_id:user,address:addressValue,mobile:mobileValue,rent:rentValue,description:descriptionValue,imgUrl:imageLink,date:new Date()};console.log(newPost);axios.post(\"http://localhost:8000/new-post\",newPost).then(function(res){if(typeof res.data=='object'){console.log(res.data);setCustomError(res.data.error);}else{window.location.href=\"/account/\".concat(user);}}).catch(function(err){return console.log(err);});}).catch(function(err){return console.log(err);});case 15:case\"end\":return _context.stop();}}},_callee);}));return function addPost(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"form-page\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Add \",/*#__PURE__*/_jsx(\"span\",{style:{color:\"black\"},children:\"Post\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"post-form\",children:[/*#__PURE__*/_jsxs(\"form\",{action:\"\",onSubmit:addPost,children:[/*#__PURE__*/_jsxs(\"label\",{for:\"uploadfile\",className:\"upload-label\",children:[\"Select Image from device \",/*#__PURE__*/_jsx(FaFileUpload,{}),\"   \",/*#__PURE__*/_jsx(\"span\",{style:{color:\"red\"},id:\"filename\",children:\"0 file selected\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"image\",accept:\"image/*\",id:\"uploadfile\",onChange:onFileUpload,multiple:true}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Address\",ref:address}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"\",id:\"\",placeholder:\"Mobile Number\",ref:mobile}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Rent\",ref:rent}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"select\",{name:\"\",id:\"\",ref:description,children:[/*#__PURE__*/_jsx(\"option\",{value:\"1 Bedroom\",children:\"1 Bed Room\"}),/*#__PURE__*/_jsx(\"option\",{value:\"2 Bedroom\",children:\"2 Bed Room\"}),/*#__PURE__*/_jsx(\"option\",{value:\"3 Bedroom\",children:\"3 Bed Room\"}),/*#__PURE__*/_jsx(\"option\",{value:\"4 Bedroom\",children:\"4 Bed Room\"})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),customError?/*#__PURE__*/_jsx(\"p\",{style:{color:\"red\"},children:customError}):'',/*#__PURE__*/_jsx(\"input\",{type:\"submit\",value:\"Add Post\",id:\"btn\",style:{backgroundColor:\"rgb(236, 89, 138)\",border:\"none\"}})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{})]})}),/*#__PURE__*/_jsx(\"h6\",{style:{textAlign:\"center\"},children:/*#__PURE__*/_jsx(\"a\",{href:\"/account/\".concat(user),children:\"Back to Account Page\"})})]});};export default NewPost;","map":{"version":3,"sources":["D:/React Projects/rental-app/rental/src/components/NewPost.jsx"],"names":["React","useEffect","axios","useState","jwtDecode","FaFileUpload","NewPost","address","createRef","mobile","rent","description","user","setUser","files","setFiles","imageLink","setImageLink","customError","setCustomError","fetchToken","token","sessionStorage","getItem","console","log","currentUser","window","location","href","onFileUpload","e","target","length","document","getElementById","innerHTML","validation","addressValue","mobileValue","rentValue","descriptionValue","mobilePattern","rentPattern","c","i","type","split","match","current","value","addPost","preventDefault","isValidated","formData","FormData","append","config","headers","post","then","res","data","push","filename","url","path","newPost","author_id","imgUrl","date","Date","error","catch","err","color","backgroundColor","border","textAlign"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { useState } from 'react';\r\nimport jwtDecode from 'jwt-decode';\r\nimport '../css/NewPost.css';\r\nimport {FaFileUpload} from 'react-icons/fa'\r\n\r\nconst NewPost = () => {\r\n    const address = React.createRef();\r\n    const mobile = React.createRef();\r\n    const rent = React.createRef();\r\n    const description = React.createRef();\r\n\r\n    const[user, setUser] = useState();\r\n    const [files, setFiles] = useState([]);\r\n    const [imageLink, setImageLink] = useState([]);\r\n    const [customError, setCustomError] = useState();\r\n\r\n    useEffect(() => {\r\n        const fetchToken = () => {\r\n            const token = sessionStorage.getItem(\"secretToken\");\r\n            console.log(token);\r\n            if(token)\r\n            {\r\n                const user = jwtDecode(token);\r\n                console.log(user.currentUser);\r\n                setUser(user.currentUser);\r\n            }\r\n            else{\r\n                window.location.href = '/home';\r\n            }\r\n        }\r\n        fetchToken();\r\n    },[])\r\n\r\n    const onFileUpload = (e) => {\r\n        setFiles(e.target.files);\r\n        if(e.target.files.length>1)\r\n        {\r\n            document.getElementById(\"filename\").innerHTML = e.target.files.length + \" files selected\";\r\n        }\r\n        else{\r\n            document.getElementById(\"filename\").innerHTML = e.target.files.length + \" file selected\";\r\n        }\r\n    }\r\n\r\n    const validation = (addressValue, mobileValue, rentValue, descriptionValue) => {\r\n        const mobilePattern = '[6789][0-9]{9}';\r\n        const rentPattern = '^[1-9]+[0-9]*$';\r\n        let c=0;\r\n        for(let i=0;i<files.length;i++)\r\n        {\r\n            if(files[i].type.split(\"/\")[1] !== 'jpeg' && files[i].type.split(\"/\")[1] !== 'jpg' && files[i].type.split(\"/\")[1] !== 'png')\r\n            {\r\n                setCustomError(\"*Only Image can be uploaded\");\r\n                console.log(files[i].type.split(\"/\")[1]);\r\n                c++;\r\n                return false;\r\n            }\r\n        }\r\n        if(c==0){\r\n        if(!files.length)\r\n        {\r\n            setCustomError(\"*Image is required\");\r\n            return false;\r\n        }\r\n        else if(files.length>4)\r\n        {\r\n            setCustomError(\"*Only 4 Images can be uploaded\");\r\n            return false;\r\n        }\r\n        else if(!addressValue)\r\n        {\r\n            setCustomError(\"*Address is required\");\r\n            return false;\r\n        }\r\n        else if(addressValue.length<10)\r\n        {\r\n            setCustomError(\"*Address should be more than 10 characters\");\r\n            return false;\r\n        }\r\n        else if(!mobileValue)\r\n        {\r\n            setCustomError(\"*Mobile Number is required\");\r\n            return false;\r\n        }\r\n        else if(!mobileValue.match(mobilePattern) || mobile.current.value.length != 10)\r\n        {\r\n            setCustomError(\"*Enter a valid Mobile Number\");\r\n            return false;\r\n        }\r\n        else if(!rentValue)\r\n        {\r\n            setCustomError(\"*Rent is required\");\r\n            return false;\r\n        }\r\n        else if(!rentValue.match(rentPattern))\r\n        {\r\n            setCustomError(\"*Rent should not be negative\");\r\n            return false;\r\n        }\r\n        else if(!descriptionValue)\r\n        {\r\n            setCustomError(\"*Description is Required\");\r\n            return false;\r\n        }\r\n        else{\r\n            setCustomError(\" \")\r\n            return true;\r\n        }\r\n    }\r\n    }\r\n    \r\n    const addPost = async(e) => {\r\n        e.preventDefault();\r\n        const addressValue = address.current.value;\r\n        const mobileValue = mobile.current.value;\r\n        const rentValue = rent.current.value;\r\n        const descriptionValue = description.current.value;\r\n        console.log(\"Clicked\");\r\n        let isValidated = validation(addressValue, mobileValue, rentValue, descriptionValue);\r\n        console.log(isValidated);\r\n        if(isValidated)\r\n        {\r\n            document.getElementById(\"btn\").value = \"Saving...\";\r\n            const formData = new FormData();\r\n            for(let i=0;i<files.length;i++)\r\n            {\r\n                formData.append(\"image\", files[i]);\r\n            }\r\n            const config = {\r\n                headers: {\r\n                    'content-type' : 'multipart/form-data'\r\n                }\r\n            }\r\n            await axios.post(\"http://localhost:8000/generate-url\", formData, config)\r\n            .then(res => {\r\n                console.log(res.data);\r\n                imageLink.length = 0;\r\n                for(let i=0;i<res.data.length;i++)\r\n                {\r\n                    imageLink.push({\r\n                        filename: res.data[i].filename,\r\n                        url: res.data[i].path\r\n                    });\r\n                }\r\n                \r\n                console.log(addressValue);\r\n                const newPost = {\r\n                    author_id: user,\r\n                    address: addressValue,\r\n                    mobile: mobileValue,\r\n                    rent: rentValue,\r\n                    description: descriptionValue,\r\n                    imgUrl: imageLink,\r\n                    date: new Date()\r\n                }\r\n                console.log(newPost);\r\n            \r\n                axios.post(\"http://localhost:8000/new-post\", newPost)\r\n                .then(res => {\r\n                        if(typeof(res.data) == 'object')\r\n                        {\r\n                            console.log(res.data);\r\n                            setCustomError(res.data.error);\r\n                        }\r\n                        else{\r\n                            window.location.href = `/account/${user}`;\r\n                        }\r\n                    })\r\n                .catch(err => console.log(err));\r\n            })\r\n            .catch(err => console.log(err));\r\n        }\r\n    }\r\n    \r\n    return ( \r\n            <div className='form-page'>\r\n            <h1>Add <span style={{color: \"black\"}}>Post</span></h1>\r\n            <div className='form-container'>\r\n            <div className='post-form'>\r\n            <form action=\"\" onSubmit={addPost}>\r\n            <label for=\"uploadfile\" className='upload-label'>Select Image from device <FaFileUpload/>   <span style={{color: \"red\"}} id=\"filename\">0 file selected</span></label>\r\n            <input type=\"file\" name=\"image\" accept='image/*' id=\"uploadfile\" onChange={onFileUpload} multiple />\r\n            <br /><br />\r\n            <input type=\"text\" placeholder='Address' ref={address} /><br /><br />\r\n            <input type=\"text\" name=\"\" id=\"\" placeholder='Mobile Number' ref={mobile} /><br /><br />\r\n            <input type=\"text\" placeholder='Rent' ref={rent} /><br /><br />\r\n            <select name=\"\" id=\"\" ref={description}>\r\n                <option value=\"1 Bedroom\">1 Bed Room</option>\r\n                <option value=\"2 Bedroom\">2 Bed Room</option>\r\n                <option value=\"3 Bedroom\">3 Bed Room</option>\r\n                <option value=\"4 Bedroom\">4 Bed Room</option>\r\n            </select><br /><br />\r\n            {customError? <p style={{color: \"red\"}}>{customError}</p>:''}\r\n            <input type=\"submit\" value=\"Add Post\" id=\"btn\" style={{backgroundColor: \"rgb(236, 89, 138)\", border: \"none\"}}/>\r\n            </form>\r\n            <br /><br />\r\n        </div>\r\n        </div>\r\n        <h6 style={{textAlign: \"center\"}}><a href={`/account/${user}`}>Back to Account Page</a></h6>\r\n        </div> \r\n        ) \r\n     \r\n}\r\n \r\nexport default NewPost;"]},"metadata":{},"sourceType":"module"}